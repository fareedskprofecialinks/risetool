"use strict";

var _Tile = _interopRequireDefault(require("ol/layer/Tile"));

var _TileWMS = _interopRequireDefault(require("ol/source/TileWMS"));

var _TileJSON = _interopRequireDefault(require("ol/source/TileJSON"));

var _TestUtil = _interopRequireDefault(require("../Util/TestUtil"));

var _Legend = _interopRequireDefault(require("./Legend"));

var _MapUtil = _interopRequireDefault(require("@terrestris/ol-util/dist/MapUtil/MapUtil"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

/*eslint-env jest*/
describe('<Legend />', function () {
  var layer1;
  var layer2;
  beforeEach(function () {
    layer1 = new _Tile["default"]({
      name: 'OSM-WMS',
      source: new _TileWMS["default"]({
        url: 'https://ows.terrestris.de/osm/service',
        params: {
          'LAYERS': 'OSM-WMS',
          'TILED': true
        },
        serverType: 'geoserver'
      })
    });
    layer2 = new _Tile["default"]({
      legendUrl: 'https://www.koeln.de/files/images/Karnevalstrikot_Spieler_270.jpg',
      name: 'A layer',
      source: new _TileJSON["default"]({
        url: 'https://example.org',
        crossOrigin: 'anonymous'
      })
    });
  });
  it('is defined', function () {
    expect(_Legend["default"]).not.toBeUndefined();
  });
  it('can be rendered', function () {
    var wrapper = _TestUtil["default"].mountComponent(_Legend["default"], {
      layer: layer1
    });

    expect(wrapper).not.toBeUndefined();
  });
  describe('Legend created with Layer', function () {
    it('takes the legendGraphic from layer.get("legendUrl") if configured', function () {
      var wrapper = _TestUtil["default"].mountComponent(_Legend["default"], {
        layer: layer2
      });

      var img = wrapper.find('img').getElement();
      expect(img.props.src).toBe(layer2.get('legendUrl'));
    });
    it('generates getLegendGraphicUrl if no "legendUrl" configured', function () {
      var wrapper = _TestUtil["default"].mountComponent(_Legend["default"], {
        layer: layer1
      });

      var img = wrapper.find('img').getElement();

      var legendUrl = _MapUtil["default"].getLegendGraphicUrl(layer1);

      expect(img.props.src).toBe(legendUrl);
    });
    it('generates getLegendGraphicUrl if no "legendUrl" configured (extraParams)', function () {
      var extraParams = {
        HEIGHT: 400,
        WIDTH: 400,
        LANGUAGE: 'de'
      };

      var wrapper = _TestUtil["default"].mountComponent(_Legend["default"], {
        layer: layer1,
        extraParams: extraParams
      });

      var img = wrapper.find('img').getElement();

      var legendUrl = _MapUtil["default"].getLegendGraphicUrl(layer1, extraParams);

      expect(img.props.src).toBe(legendUrl);
    });
    it('creates an alt attribute corresponding to layername', function () {
      var wrapper = _TestUtil["default"].mountComponent(_Legend["default"], {
        layer: layer1
      });

      var img = wrapper.find('img').getElement();
      expect(img.props.alt).toBe("".concat(layer1.get('name'), " legend"));
    });
  });
});